toko=# UPDATE products SET stock = 15 WHERE id = 1;
UPDATE 1
toko=# create or replace procedure transaction (customer_id int, product_id int, quantity int )
toko-# language plpgsql
toko-# as $$
toko$# DECLARE stock_product int;
toko$# begin
toko$# select stock into stock_product from products where id = product_id;
toko$# if quantity >= 1 and stock_product >= quantity then
toko$# insert into transactions (product_id, customers_id, quantity) values (product_id, customers_id, quantity);
toko$# UPDATE products SET stock = stock - quantity where id = product_id;
toko$# else raise exception 'error stock  or quantity';
toko$# end if;
toko$# end; $$;
CREATE PROCEDURE
toko=#